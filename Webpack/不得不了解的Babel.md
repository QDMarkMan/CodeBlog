# ä¸å¾—ä¸äº†è§£çš„babel
`Babel`

## Preset
> é¢„è®¾ï¼Œç›¸å½“äºç¼–è¯‘åˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚ä¹Ÿå¯ä»¥è¯´æ˜¯æŸä¸€ç±» plugin çš„é›†åˆï¼ŒåŒ…å«äº†æŸä¸€ç±»æ’ä»¶çš„æ‰€æœ‰åŠŸèƒ½ã€‚æ¯å¹´æ¯ä¸ª preset åªç¼–è¯‘å½“å¹´æ‰¹å‡†çš„å†…å®¹ã€‚ è€Œ babel-preset-env ç›¸å½“äº es2015 ï¼Œes2016 ï¼Œes2017 åŠæœ€æ–°ç‰ˆæœ¬ã€‚

ä½¿ç”¨çš„æ—¶å€™éœ€è¦å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼Œå¯¹åº”`babel-preset-xxx`ï¼Œä¾‹å¦‚ä¸‹é¢çš„é…ç½®ï¼Œéœ€è¦`npm install babel-preset-env`ã€‚
```bash
{
  "presets": ["es2015"]
}
```

å¦‚æœä½ æä¸æ‡‚æˆ–è€…æ˜¯æ²¡æœ‰æ˜ç¡®çš„ç›®æ ‡ä½¿ç”¨ä»€ä¹ˆpresetï¼Œæ¨èä½¿ç”¨`babel-preset-env`ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œå°±åƒä¸Šé¢è¯´çš„é‚£æ ·ã€‚

### envé…ç½®

```bash
"presets": [
  ["env", {
    "modules": false,
    "targets": { 
      "browsers": ["> 1%", "last 2 versions", "not ie <= 8"]
    }
  }],
  "stage-2"
]
```
- **targets**ï¼š éœ€è¦æ”¯æŒçš„ç¯å¢ƒï¼Œå¯é€‰ä¾‹å¦‚ï¼šchrome, edge, firefox, safari, ie, ios, nodeï¼Œç”šè‡³å¯ä»¥åˆ¶å®šç‰ˆæœ¬ï¼Œå¦‚`node: 6.5`ã€‚ä¹Ÿä½¿ç”¨`node: currentä»£`è¡¨ä½¿ç”¨å½“å‰çš„ç‰ˆæœ¬ã€‚

- **browsers**ï¼š æµè§ˆå™¨åˆ—è¡¨ï¼Œå…·ä½“æ˜¯å“ªäº›æµè§ˆå™¨å¯ä»¥çœ‹[browserslist](https://browsersl.ist/)ã€‚åƒè¿™äº›`" > 1%", "last 2 versions"` éƒ½æ˜¯æŸ¥è¯¢å‚æ•°

- **loose**ï¼š æ˜¯å¦ä½¿ç”¨å®½æ¾æ¨¡å¼ï¼Œå¦‚æœè®¾ç½®ä¸º`true`ï¼Œpluginsé‡Œçš„æ’ä»¶å¦‚æœå…è®¸ï¼Œéƒ½ä¼šé‡‡ç”¨å®½æ¾æ¨¡å¼ã€‚

- **debug**ï¼š ç¼–è¯‘æ˜¯å¦ä¼šå»æ‰`console.log`ã€‚è¿™ä¸ªé…ç½®ä¸æ˜¯å¿…è¦çš„ã€‚

- **whitelist**ï¼š è®¾ç½®ä¸€ç›´å¼•å…¥çš„pluginsåˆ—è¡¨ã€‚

- **es2015/es2016/es2017/latest** 
    - `es2015` ä½¿ç”¨es2015çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„es6çš„ç›¸å…³æ–¹æ³•
    - `es2016` ä½¿ç”¨es2016çš„ç›¸å…³æ’ä»¶ï¼Œä¹Ÿå°±æ˜¯es7.
    - `es2017` ä½¿ç”¨es2017çš„ç›¸å…³æ’ä»¶ï¼Œä¹Ÿå°±æ˜¯es8
    - `latest` latestæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„presetsï¼ŒåŒ…æ‹¬äº†es2015ï¼Œes2016ï¼Œes2017çš„æ’ä»¶ï¼ˆç›®å‰ä¸ºæ­¢ï¼Œä»¥åæœ‰es2018ä¹Ÿä¼šåŒ…æ‹¬è¿›å»ï¼‰ã€‚
    - `react` reactæ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„å®˜æ–¹æ¨èçš„presetsï¼Œå¤§æ¦‚æ˜¯å› ä¸ºæ¯”è¾ƒç«å§ã€‚åŠ å…¥äº†`flow`ï¼Œ`jsx`ç­‰ã€‚


## Stage(stage-0/1/2/3/4)

`stage-x`å’Œä¸Šé¢çš„`es2015`ç­‰æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯æŒ‰ç…§`JavaScript`çš„ææ¡ˆé˜¶æ®µåŒºåˆ†çš„ï¼Œä¸€å…±æœ‰5ä¸ªé˜¶æ®µã€‚è€Œæ•°å­—è¶Šå°ï¼Œé˜¶æ®µè¶Šé åï¼Œå­˜åœ¨ä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´`stage-0`æ˜¯åŒ…æ‹¬`stage-1`çš„ï¼Œä»¥æ­¤ç±»æ¨ã€‚

`stage-4`åº”è¯¥æ˜¯åŒ…æ‹¬es2015ï¼Œes2016ï¼Œes2017ã€‚ç»è¿‡æµ‹è¯•ï¼Œbabel-preset-stage-4è¿™ä¸ªnpmåŒ…æ˜¯ä¸å­˜åœ¨çš„ï¼Œå¦‚æœä½ å•çº¯çš„éœ€è¦stage-4çš„ç›¸å…³æ–¹æ³•ï¼Œéœ€è¦å¼•å…¥es2015~es2017çš„presetsã€‚


## Plugin

æ’ä»¶é…ç½®:  å°†æŸä¸€ç§éœ€è¦è½¬åŒ–çš„ä»£ç ï¼Œè½¬ä¸ºæµè§ˆå™¨å¯ä»¥æ‰§è¡Œä»£ç ã€‚æ’ä»¶éœ€è¦æ­é…`babel`ç›¸åº”çš„æ’ä»¶è¿›è¡Œé…ç½®ï¼Œå¯ä»¥é€‰æ‹©é…ç½®æ’ä»¶æ¥æ»¡è¶³å•ä¸ªéœ€æ±‚ã€‚ä½†æ˜¯è¿™äº›æ’ä»¶ä»ç»´æŠ¤åˆ°ä¹¦å†™æä¸ºéº»çƒ¦ï¼Œåæ¥å®˜æ–¹ç»Ÿä¸€æ¨èä½¿ç”¨`env`ï¼Œå…¨éƒ¨æ›¿ä»£äº†è¿™äº›å•ä¸€çš„æ’ä»¶åŠŸèƒ½ï¼Œå¯ä»¥ç®€åŒ–é…ç½®å¦‚ä¸‹ï¼Œä¹Ÿå°±æ˜¯å‰é¢æåˆ°äº†`babel-preset-env`ï¼š

è¿™é‡Œä¸»è¦ä»‹ç»ä¸¤æ¬¾å¸¸ç”¨æ’ä»¶ï¼Œåˆ†åˆ«æ˜¯`babel-plugin-transform-runtime`ï¼Œ`babel-plugin-syntax-dynamic-import`ã€‚

- **transform-runtime**

ä¸ºäº†è§£å†³è¿™ç§å…¨å±€å¯¹è±¡æˆ–è€…å…¨å±€å¯¹è±¡æ–¹æ³•ç¼–è¯‘ä¸è¶³çš„æƒ…å†µï¼Œæ‰å‡ºç°äº†transform-runtimeè¿™ä¸ªæ’ä»¶ï¼Œä½†æ˜¯å®ƒåªä¼šå¯¹es6çš„è¯­æ³•è¿›è¡Œè½¬æ¢ï¼Œè€Œä¸ä¼šå¯¹æ–°apiè¿›è¡Œè½¬æ¢

- è§£å†³ç¼–è¯‘ä¸­äº§ç”Ÿçš„é‡å¤çš„å·¥å…·å‡½æ•°ï¼Œå‡å°ä»£ç ä½“ç§¯
- éå®ä¾‹æ–¹æ³•çš„`poly-fillï¼Œå¦‚Object.assign`ï¼Œä½†æ˜¯å®ä¾‹æ–¹æ³•ä¸æ”¯æŒï¼Œå¦‚`"foobar".includes("foo")ï¼Œ`è¿™æ—¶å€™éœ€è¦å•ç‹¬å¼•å…¥`babel-polyfill`

```bash
{
  "plugins": ["transform-runtime", options]
}
```

`options`æœ‰ä»¥ä¸‹çš„é€‰é¡¹
- `helpers` ä½¿ç”¨babelçš„helperå‡½æ•°ã€‚ 
- `polyfill` ä½¿ç”¨babelçš„polyfillï¼Œä½†æ˜¯ä¸èƒ½å®Œå…¨å–ä»£babel-polyfillã€‚
- `regenerator` ä½¿ç”¨babelçš„regeneratorã€‚
- `moduleName` ä½¿ç”¨å¯¹åº”moduleå¤„ç†

- **syntax-dynamic-import**

è¿™ä¸ªæ’ä»¶ä¸»è¦è§£å†³åŠ¨æ€å¼•å…¥æ¨¡å—çš„é—®é¢˜ï¼Œå®ƒä¼šæ‰€æœ‰çš„`import` è½¬åŒ–ä¸º`require`å¼•å…¥ã€‚


## æ‰§è¡Œé¡ºåº

1. æ‰§è¡Œ `plugins` ä¸­æ‰€æœ‰çš„æ’ä»¶
2. `plugins` çš„æ’ä»¶ï¼ŒæŒ‰ç…§é¡ºåºä¾èµ–ç¼–è¯‘
3. æ‰€æœ‰ `plugins` çš„æ’ä»¶æ‰§è¡Œå®Œæˆï¼Œåœ¨æ‰§è¡Œ `presets` é¢„è®¾ã€‚
4. `presets` é¢„è®¾ï¼ŒæŒ‰ç…§å€’åºçš„é¡ºåºæ‰§è¡Œã€‚(ä»æœ€åä¸€ä¸ªæ‰§è¡Œ)
5. å®Œæˆç¼–è¯‘ã€‚

## babel-ployfill

å› ä¸º`babel`é»˜è®¤åªæ˜¯è½¬æ¢æ–°çš„`JavaScript`å¥æ³•ï¼Œè€Œä¸è½¬æ¢æ–°çš„`API `æ¯”å¦‚`Iterator Generator Set Maps Proxy Relfact Symbol Promise `ç­‰å…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç›´æ¥å¯¹ä»£ç è¿›è¡Œå«ç‰‡æ“ä½œï¼ŒIEçš„å…¼å®¹æ˜¯éå¸¸çš„å¿…é¡»çš„ã€‚ä½¿ç”¨æ–¹å¼ï¼š

é…åˆ`webpack`ä½¿ç”¨çš„è¯åœ¨å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶ä¸­å¼•ç”¨ä¸€ä¸‹å†åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å…¥å£ã€‚
```js
// entry
require("babel-polyfill");
//webpak config
module.exports = {
ã€€ã€€entry: ["babel-polyfill", "./app/js"]
}
```

## `browserslist` 

æˆ‘æ„Ÿè§‰å¾ˆå¤šäººä¸çŸ¥é“è¿™ä¸ªæ€ä¹ˆé…ç½®

æ ¹æ®æä¾›çš„ç›®æ ‡æµè§ˆå™¨çš„ç¯å¢ƒæ¥ï¼Œæ™ºèƒ½æ·»åŠ `css`å‰ç¼€ï¼Œ`js`çš„`polyfill`å«ç‰‡,æ¥å…¼å®¹æ—§ç‰ˆæœ¬æµè§ˆå™¨ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘çš„æ·»åŠ ã€‚é¿å…ä¸å¿…è¦çš„å…¼å®¹ä»£ç ï¼Œä»¥æé«˜ä»£ç çš„ç¼–è¯‘è´¨é‡ã€‚

æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ä¸‹é¢çš„å‚æ•°ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Œä¸‹é¢çš„å‚æ•°çœ‹ä¼šäº†ï¼ŒåŸºæœ¬å°±ä¼šé…ç½®äº†ï¼Œè¿™é‡Œæ˜¯[å®˜æ–¹æ–‡æ¡£](https://github.com/browserslist/browserslist#queries)

| é…ç½® | è¯´æ˜ |
| :------ | :------ |
| `> 1%` | å…¨çƒè¶…è¿‡1%äººä½¿ç”¨çš„æµè§ˆå™¨ |
| `last 2 versions` | æ‰€æœ‰æµè§ˆå™¨å…¼å®¹åˆ°æœ€åä¸¤ä¸ªç‰ˆæœ¬æ ¹æ®CanIUse.comè¿½è¸ªçš„ç‰ˆæœ¬ |
| `> 5% in US	` | æŒ‡å®šå›½å®¶ä½¿ç”¨ç‡è¦†ç›– |
| `Firefox ESR` | ç«ç‹æœ€æ–°ç‰ˆæœ¬ |
| `Firefox > 20` | æŒ‡å®šæµè§ˆå™¨çš„ç‰ˆæœ¬èŒƒå›´ |
| `not ie <=8` | æ–¹å‘æ’é™¤éƒ¨åˆ†ç‰ˆæœ¬ |
| `Firefox 12.1	` | æŒ‡å®šæµè§ˆå™¨çš„å…¼å®¹åˆ°æŒ‡å®šç‰ˆæœ¬ |
| `unreleased versions	` | æ‰€æœ‰æµè§ˆå™¨çš„betaæµ‹è¯•ç‰ˆæœ¬ |
| `unreleased Chrome versions	` | æŒ‡å®šæµè§ˆå™¨çš„æµ‹è¯•ç‰ˆæœ¬ |
| `since 2013	` | 2013å¹´ä¹‹åå‘å¸ƒçš„æ‰€æœ‰ç‰ˆæœ¬ |


# æ€»ç»“
`Babel`å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›æœ‰ä¸€å¤©èƒ½å¤Ÿä¸å†éœ€è¦äº†ğŸ˜